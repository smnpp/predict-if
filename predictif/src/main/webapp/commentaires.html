<!DOCTYPE html>
<html>
    <head>
        <title>Commentaires</title>
        <meta charset="UTF-8">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body>
        <h1>Predicti'IF - Commentaires</h1>

        <div id="head-band">
            <button id="bouton-accueil-connecte">Accueil</button>
            <button id="logout">Déconnexion</button>
        </div>

        <div id="corps">
            <div id="comment-history"></div>
        </div>

        <script>
            $(document).ready(function () {
                // Charger l'historique des commentaires
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        todo: 'listerCommentaires'
                    },
                    dataType: 'json'
                }).done(function (response) {
                    console.log("Réponse reçue pour 'listerCommentaires'.");
                    var commentHistory = $("#comment-history");
                    if (response.liste && response.liste.length > 0) {
                        response.liste.forEach(function (comment) {
                            var commentaireHtml = `<p>Commentaire: ${comment}</p>`;
                            commentHistory.append(commentaireHtml);
                        });
                    } else {
                        commentHistory.html("<p>Aucun commentaire trouvé.</p>");
                    }
                }).fail(function (error) {
                    console.error('Échec de l\'appel AJAX pour lister les commentaires.', error);
                    $("#comment-history").html("<p>Erreur lors de la récupération des commentaires.</p>");
                });

                // Gestion de la déconnexion
                $('#logout').on('click', function () {
                    console.log("Tentative de déconnexion...");
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'deconnexion'
                        },
                        dataType: 'json'
                    }).done(function (response) {
                        if (response.success) {
                            console.log("Déconnexion réussie.");
                            localStorage.removeItem('commentValidated');
                            window.location.href = 'index.html';
                        } else {
                            console.error("Échec de la déconnexion:", response.message);
                            alert("Déconnexion échouée: " + response.message);
                        }
                    }).fail(function (error) {
                        console.error('Erreur lors de la déconnexion:', error);
                        alert("Erreur lors de l'appel AJAX: " + error.statusText);
                    });
                });

                // Redirection vers la page d'accueil
                $('#bouton-accueil-connecte').on('click', function () {
                    console.log("Redirection vers la page d'accueil...");
                    window.location.href = 'index.html';
                });
            });
        </script>
    </body>
</html>